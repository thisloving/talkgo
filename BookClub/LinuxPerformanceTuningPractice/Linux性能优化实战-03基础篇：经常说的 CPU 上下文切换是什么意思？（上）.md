## CPU 上下文

```
每个任务运行前，CPU 都需要知道任务从哪里加载、又从哪里开始运行，也就是说，需要系统事先帮它设置好 CPU 寄存器和程序计数器，CPU 寄存器，是 CPU 内置的容量小、但速度极快的内存。而程序计数器，则是用来存储 CPU 正在执行的指令位置、或者即将执行的下一条指令位置。它们都是 CPU 在运行任何任务前，必须的依赖环境，因此也被叫做 CPU 上下文
```

## CPU 上下文切换

```
CPU 上下文切换，就是先把前一个任务的 CPU 上下文（也就是 CPU 寄存器和程序计数器）保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，最后再跳转到程序计数器所指的新位置，运行新任务。
```

根据任务的不同，CPU 的上下文切换就可以分为几个不同的场景

###  进程上下文切换

进程的上下文不仅包括了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的状态。

系统调用过程通常称为特权模式切换，系统调用过程中，CPU 的上下文切换还是无法避免的。进程调度的时候，才需要切换上下文。

触发切换进程上下文：

1、CPU 时间片。

2、系统资源不足（比如内存不足）。

3、进程 sleep 。

4、高优先级抢占都会。

5、发生硬件中断时

### 线程上下文切换

线程与进程最大的区别在于：

```
线程是调度的基本单位，而进程则是资源拥有的基本单位。
```

线程会共享相同的虚拟内存和全局变量等资源，线程也有自己的私有数据，比如栈和寄存器等。同进程内的线程切换，要比多进程间的切换消耗更少的资源。

### 中断上下文切换

中断处理会打断进程的正常调度和执行，转而调用中断处理程序，响应设备事件。中断处理比进程拥有更高的优先级，所以中断上下文切换并不会与进程上下文切换同时发生。

## 总结

了解了cpu上下文以及cpu上下文切换概念。